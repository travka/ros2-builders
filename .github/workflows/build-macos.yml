name: Build macOS

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build-macos:
    runs-on: macos-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Set up Homebrew
        run: |
          /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"

      - name: Install dependencies
        run: |
          brew install cmake python@3.11
          pip3 install --break-system-packages pyyaml

      - name: Validate Homebrew formula syntax
        run: |
          ruby -c ./builders/macos/ros2-humble.rb

      - name: Test formula installation
        run: |
          brew install --formula ./builders/macos/ros2-humble.rb || echo "Installation check completed"
